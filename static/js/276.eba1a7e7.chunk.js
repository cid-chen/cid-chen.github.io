"use strict";(self.webpackChunksite_use_like_vue=self.webpackChunksite_use_like_vue||[]).push([[276],{276:(e,n,t)=>{t.r(n),t.d(n,{default:()=>s});var r=t(9950),o=t(7172),a=t(4414);const c=()=>{const[e,n]=(0,o.i)(r,{view:e=>{let{$VM:n,methods:t,refDOM:r}=e;return(0,a.jsxs)("div",{children:["Data obj1: ",JSON.stringify(n("obj1")),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),n("isShowSolution")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{target:"_blank",href:"https://bookzone.cwgv.com.tw/article/655",children:"\u5fc3\u88ab\u4e16\u754c\u62c9\u8457\u8d70\u600e\u9ebc\u8fa6?"}),(0,a.jsx)("br",{}),(0,a.jsx)("a",{target:"_blank",href:"https://www.youtube.com/watch?v=s6g68rXh0go",children:"\u4eba\u751f\u771f\u6b63\u7684\u5feb\u6a02\u662f\u4ec0\u9ebc?"}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{})]}):null,(0,a.jsx)("button",{onClick:t.changeObj1Data,children:"change obj1"})]})},methods:e=>{let{$VM:n,getMethods:t,memoBox:r,$DOM:o,nextTick:a}=e;return{changeObj1Data:function(){n("obj1").val({data1:"\u4eba\u751f\u9700\u8981\u6c89\u6fb1, \u95dc\u61f7\u81ea\u5df1, \u4eab\u53d7\u904e\u7a0b"+(new Date).getTime()})},obj1ChangedAlarm:function(e,n){alert(JSON.stringify(n)+"=>"+JSON.stringify(e))},showSolution:function(){1!=n("isShowSolution").now()&&n("isShowSolution").val(!0)}}},data:{obj1:{data1:"\u4eba\u751f\u7684\u8a31\u591a\u7169\u60f1\u7126\u616e, \u4f86\u81ea\u65bc\u548c\u4eba\u8a08\u8f03\u8207\u6bd4\u8f03, \u8a98\u4f7f\u653e\u68c4\u539f\u672c\u771f\u6b63\u60f3\u8981\u8d70\u7684\u8def\u800c\u8ff7\u5931\u65b9\u5411"},isShowSolution:!1},onDataChange:(e,n)=>{alert("some VM data changed!"),e("obj1",((e,t)=>{n.obj1ChangedAlarm(e,t)})),e("obj1",((e,t)=>{n.showSolution(),alert("alert again!")}))},onViewWillUpdate(e){alert("onViewWillUpdate trigger!")},onViewUpdated(e){alert("onViewUpdated trigger!")}});return(0,a.jsx)(a.Fragment,{children:e})};const s=function(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom",children:[(0,a.jsx)("h1",{children:"Data Watch \u6578\u64da\u76e3\u807d"}),(0,a.jsx)("div",{className:"btn-toolbar mb-2 mb-md-0",children:(0,a.jsxs)("div",{className:"me-2",children:[(0,a.jsx)("a",{href:"https://github.com/cid-chen/react-mvvm-component",target:"_blank",className:"btn btn-sm btn-outline-secondary",children:"View on GitHub"}),"\xa0",(0,a.jsx)("a",{href:"https://ko-fi.com/O4O21IE7IA",target:"_blank",children:(0,a.jsx)("img",{height:"34",style:{border:"0px",height:"34px"},src:"https://storage.ko-fi.com/cdn/kofi6.png?v=6",border:"0",alt:"Buy Me a Coffee at ko-fi.com"})})]})})]}),(0,a.jsx)("br",{}),(0,a.jsx)("h5",{children:"\u300c\u72c0\u614b\u96c6\u4e2d\u76e3\u63a7\u3001\u76e3\u63a7\u8ab0\u5c31\u5beb\u8ab0\uff0c\u66f4\u9748\u6d3b\u3001\u66f4\u76f4\u89ba\u3002\u300d"}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)("h2",{className:"h2",children:"data watch"}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,a.jsx)("li",{className:"list-group-item",children:(0,a.jsx)(c,{})}),(0,a.jsx)("li",{className:"list-group-item",children:"\u6578\u64da\u7684\u76e3\u807d\u5668 onDataChange \u8207\u89f8\u767c\u6642\u6a5f"}),(0,a.jsx)("li",{className:"list-group-item",children:(0,a.jsx)("div",{children:(0,a.jsxs)("pre",{children:[(0,a.jsx)("div",{className:"hljs-label",children:"js"}),(0,a.jsx)("code",{className:"language-javascript",dangerouslySetInnerHTML:{__html:(e="import React from 'react';\nimport { useRespectVue } from '@gratefuljs/react-mvvm-component';\n\nconst Example7_1 = ()=>{\n  \n  const [MVVMComponent, VMmethodsAPI] = useRespectVue(React, {\n    view : ({$VM, methods, refDOM}) => (\n      <div>\n        Data obj1: { JSON.stringify($VM('obj1')) /*JSON.stringify($VM('*')) show all*/}\n        <br/><br/>\n        { $VM('isShowSolution') ? (<>\n            <a target=\"_blank\" href=\"https://bookzone.cwgv.com.tw/article/655\">\n              \u5fc3\u88ab\u4e16\u754c\u62c9\u8457\u8d70\u600e\u9ebc\u8fa6?\n            </a>\n            <br/>\n            <a target=\"_blank\" href=\"https://www.youtube.com/watch?v=s6g68rXh0go\">\n              \u4eba\u751f\u771f\u6b63\u7684\u5feb\u6a02\u662f\u4ec0\u9ebc?\n            </a>\n            <br/><br/>\n        </>) : null }\n        <button onClick={methods.changeObj1Data}>change obj1</button>\n      </div>),\n    methods : ({$VM, getMethods, memoBox, $DOM, nextTick}) => ({\n      changeObj1Data : function(){\n\n        $VM('obj1').val({\n          data1: '\u4eba\u751f\u9700\u8981\u6c89\u6fb1, \u95dc\u61f7\u81ea\u5df1, \u4eab\u53d7\u904e\u7a0b' + new Date().getTime(),\n        });\n      },\n      obj1ChangedAlarm : function(newData, oldData){\n\n        alert(JSON.stringify(oldData) +'=>'+ JSON.stringify(newData));\n      },\n      showSolution : function(){\n\n        if( $VM('isShowSolution').now() != true ){\n          \n          $VM('isShowSolution').val(true); // \u6703\u518d\u6b21\u89f8\u767c onViewUpdated\n        }\n      },\n    }),\n    data : {\n      obj1 : {\n        data1 : \"\u4eba\u751f\u7684\u8a31\u591a\u7169\u60f1\u7126\u616e, \u4f86\u81ea\u65bc\u548c\u4eba\u8a08\u8f03\u8207\u6bd4\u8f03, \u8a98\u4f7f\u653e\u68c4\u539f\u672c\u771f\u6b63\u60f3\u8981\u8d70\u7684\u8def\u800c\u8ff7\u5931\u65b9\u5411\",\n      },\n      isShowSolution : false,\n    },\n    onDataChange : (watchVM, methods)=>{\n\n      // \u8b66\u544a: \u8acb\u907f\u514d\u5728\u7121\u689d\u4ef6\u5224\u65b7\u7684\u60c5\u6cc1\u4e0b\u547c\u53eb\u66f4\u65b0VM\u7684\u65b9\u6cd5\uff0c\u5426\u5247\u6703\u89f8\u767c\u81ea\u5df1\u66f4\u65b0\u81ea\u5df1\u7684\u5faa\u74b0\u91cd\u65b0\u6e32\u67d3\uff0c\u5c0e\u81f4\u5d29\u6f70\n      alert('some VM data changed!'); // on any change\n\n\n      watchVM('obj1', (newData, oldData)=>{\n        \n        methods.obj1ChangedAlarm(newData, oldData);\n      });\n\n      watchVM('obj1', (newData, oldData)=>{ // \u5141\u8a31\u5c0d\u540c\u500b key \u8a3b\u518a\u591a\u6b21\u76e3\u807d\n        \n        methods.showSolution();\n        \n        alert('alert again!');\n      });\n    },\n    onViewWillUpdate(methods) {\n\n      // \u5728\u5168\u90e8\u7684\u6578\u64da\u76e3\u807d\u4e8b\u4ef6\u90fd\u89f8\u767c\u5f8c\uff0c\u9019\u884c\u624d\u6703\u89f8\u767c\n      alert('onViewWillUpdate trigger!')\n    },\n    onViewUpdated(methods) {\n\n      alert('onViewUpdated trigger!')\n    },\n  });\n\n  return (<>{MVVMComponent}</>);\n};\n            ",document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML)}})]})})})]})}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{})]});var e}},7172:(e,n,t)=>{t.d(n,{i:()=>M});const r={},o={},a="onViewWillMount",c="onViewMounted",s="onViewWillUpdate",i="onViewUpdated",u="onViewWillUnmount",l="onViewUnmounted",h="onDataChange",d="methods",m="view",f="mixins",w="computed",p="$VM",g="function",b="object",j="nextTick",y="watch",x="init",v="paramErr1",V="memoBox",O="undefined",M=(e,n)=>{if(typeof e.version===O||e.version.split(".")[0]<17)return void console.error("params1 must be React and version >= 17 !");const{useState:t,useEffect:M,useRef:S,createRef:k,isValidElement:D}=e,P=S(0),N=S(!1);let $=Y(n.data);const[C,A]=t([null,$]),T=S($),U=S($);$=null;const[_,J]=t(null),R=S(!1),W=S(!1),B=S(!1),E=S(!1),F=S(null),I=S(null),q=(S({}),S("")),H=S(!1),X=(S(""),S({}),S({})),z=S(!1),L=S(null),G=(S({}),S({})),K=(S(),S(0));function Q(e,n){const t=Object.keys,r=typeof e;return e&&n&&r===b&&r===typeof n?t(e).length===t(n).length&&t(e).every((t=>Q(e[t],n[t]))):e===n}function Y(e){let n=Array.isArray(e)?[]:{};for(let t in e){let r=e[t];n[t]=typeof r===b&&null!==e?Y(r):r}return n}function Z(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=e=>{throw t+e};if(-1===n.indexOf("."))return e.hasOwnProperty(n)?e[n]:void r(n);const o=n.split("."),a=o.shift();if(e.hasOwnProperty(a))return t+=a+".",Z(e[a],o.join("."),t);r(a)}z.current={set:function(e,n){return X.current[e]=n,typeof X.current[e]!==O},get:function(e){return X.current[e]||!1},del:function(e){return delete X.current[e],typeof X.current[e]===O}};const ee=()=>{if(!1!==H.current){const e=H.current[q.current];let n;for(let t=0,r=e.length;t<r;t++){if(n=e.shift(),!0===E.current)return;typeof n===g&&n()}delete H.current[q.current],H.current=!1,q.current=""}},ne=(e,n)=>{const t=n,r=e[0];typeof r===g&&r(),t()},te=e=>{setTimeout((()=>{window.requestAnimationFrame((function(){setTimeout((()=>{e()}),0)}))}),0)},re=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e){case x:(()=>{const[e,t]=n;console.error(`${e} error: "${t}" is not init in the data object !`)})();break;case"dom":(()=>{const e=n;console.error(`$DOM error: use DOM key "${e}" is not exist !`)})();break;case v:(()=>{const[e,t]=n;console.error(`${e} error: param ${t} must be function !`)})();break;case"jsx":(()=>{const e=n;console.error(`${e}: must be a valid react component(JSX) !`)})()}},oe=function(e){return e(((t={})[p]=e=>{return(t={}).key=e,t.val=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(B.current)return;let o=()=>{};const a=this.key;typeof t===g?(o=()=>(t(),!0),typeof n[h]===g&&n[h](((n,t)=>{if(typeof t===g){if("*"!==n)try{let r,o,c=!0;if(r=e,o=U.current[a],!U.current.hasOwnProperty(a))throw n;n==a&&!0===c&&!1===Q(r,o)&&t(r,o)}catch(e){re(x,[y,n]),isToCompare=!1}}else re(v,[y,"2"])}),F.current),!0===R.current&&n.hasOwnProperty(s)&&n[s](F.current,r),A((n=>{const[t,r]=n,c={ref:null};new Promise((e=>{e(Promise.resolve((()=>new Promise((e=>{window.requestAnimationFrame((function(){e()}))})))))})).then((e=>new Promise((n=>{setTimeout((()=>{n(e)}),0)})).then((e=>(Promise.resolve((e=>e)).then((e=>Promise.resolve(e()))),()=>{U.current=c.ref}))))).then((e=>{e()}));let s=(e=>{let n=e;return Array.isArray(e)?n=[...e]:typeof e===b&&(n={...e}),n})(r),i=a;return c.ref=s,c.ref[i]=e,[o,{...s}]}))):re(v,[`${p}.val`,"2"])},t.update=function(e){let n;return e&&(n=e()),this},t.now=function(){const e=this.key;let n={...T.current};try{let t=n[e];return n=Array.isArray(t)||typeof t===b?Y(t):JSON.parse(JSON.stringify(t)),n}catch(n){return re(x,[p,e]),null}},t.then=function(e){e&&e()},t;var t},t[V]=z.current,t.getMethods=()=>F.current,t.$DOM=e=>!0!==G.current.hasOwnProperty(e)?(re("dom",e),null):G.current[e].current,t[j]=e=>{typeof e===g?(""===q.current&&(q.current=(.001*window.crypto.getRandomValues(new Uint8Array(1))).toString(36).slice(2,7)),!1===H.current&&(H.current=[],H.current[q.current]=[]),H.current[q.current].push(e)):re(v,[j,"1"])},t.eventBus=r,t.batchUpdate=function(){},t.globalBox=o,t));var t};if(null===F.current){if(F.current={},n.hasOwnProperty(d)){if(typeof n[d]!==g)return void re(v,[d,"1"]);let e=n[d];F.current=oe(e),e=null}n.hasOwnProperty(f),F.current.unmountView=()=>{!1===E.current&&(E.current=!0,B.current=!0,n.hasOwnProperty(u)&&n[u](F.current,r),A(!1),J(null))}}return null===L.current&&(L.current={},n.hasOwnProperty(w)),null===I.current&&(I.current={},n.hasOwnProperty(f)),M((()=>{!1!==C?(T.current=Y(C[1]),((e,t,r,o)=>{const a=n=>{if("*"===n)return e;try{return Z(e,n)}catch(e){return re(x,[p,e]),null}},c=e=>(!0===G.current.hasOwnProperty(e)||(G.current[e]=k()),G.current[e]),s=n[m]((e=>(e[p]=a,e[d]=t,e.refDOM=c,e[w]=r,e[V]=z.current,e.components=o,e))({}));!0===D(s)?J(s):re("jsx",m)})(C[1],F.current,L.current,I.current)):J(null)}),[C]),M((()=>{!0===W.current&&!0!==E.current&&te((()=>{((e,t,o)=>{const a=e;!0!==E.current&&(n.hasOwnProperty(i)&&n[i](F.current,r),a(t,o))})(ne,C,ee)}))}),[C]),M((()=>{if(!0!==E.current){if(!0===R.current&&!1===W.current)te((()=>{setTimeout((()=>{n.hasOwnProperty(c)&&n[c](F.current,r)}),0)})),W.current=!0;else if(!0===W.current&&N.current&&2==P.current)return void(P.current=3);!1===R.current&&null===_&&(n.hasOwnProperty(a)&&n[a](F.current,r),R.current=!0)}else te((()=>{n.hasOwnProperty(l)&&n[l](F.current,r),T.current=null,F.current=null}))}),[_]),M((()=>{P.current++,P.current>1&&(N.current=!0)}),[]),M((()=>()=>{setTimeout((()=>{window.requestAnimationFrame((function(){setTimeout((()=>{N.current&&K.current++,1!=K.current&&(B.current=!0,n.hasOwnProperty(u)&&n[u](F.current,r),E.current=!0,setTimeout((()=>{n.hasOwnProperty(l)&&n[l](F.current,r)}),0))}),0)}))}),0)}),[]),[_,F.current,r]}}}]);