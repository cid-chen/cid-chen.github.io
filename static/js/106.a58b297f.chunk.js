"use strict";(self.webpackChunksite_use_like_vue=self.webpackChunksite_use_like_vue||[]).push([[106],{1106:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});var r=t(9950),o=t(927),s=t(4414);const u=()=>{const[e,n]=(0,o.i)(r,{view:e=>{let{$VM:n,methods:t,refDOM:r}=e;return(0,s.jsxs)("div",{style:{border:"solid 1px black",width:"100%",height:"100px"},children:[n("showText"),(0,s.jsx)("button",{type:"button",onClick:t.updateSomething,children:"update ComponentA"})]})},methods:e=>{let{$VM:n,getMethods:t,memoBox:r,$DOM:o,nextTick:s}=e;return{stepMsg:e=>{alert("Lifecycle Demo: "+e)},updateSomething:()=>{const e=n("showText");e.val(e.now()+"55",(()=>{e.val(e.now()+"66",(()=>{s((()=>{t().stepMsg("nextTick trigger!")}))}))}))}}},data:{showText:"ComponentA here!"},onDataChange:(e,n)=>{n.stepMsg("some Data Changed!"),e("showText",((e,t)=>{n.stepMsg(t+" => "+e)}))},onViewWillMount(e){e.stepMsg("Component will mount!")},onViewMounted(e){e.stepMsg("Component mounted!")},onViewWillUpdate(e){e.stepMsg("Component will update!")},onViewUpdated(e){e.stepMsg("Component updated!")},onViewWillUnmount(e){e.stepMsg("Component will unmount!")},onViewUnmounted(e){e.stepMsg("Component unmounted!")}});return(0,s.jsx)(s.Fragment,{children:e})},c=()=>{const[e,n]=(0,o.i)(r,{view:e=>{let{$VM:n,methods:t,refDOM:r}=e;return(0,s.jsxs)(s.Fragment,{children:[n("isShowComponent")&&(0,s.jsx)(u,{}),(0,s.jsx)("button",{type:"button",onClick:t.setIsShowComponent,children:"generate / destroy ComponentA"})]})},methods:e=>{let{$VM:n,getMethods:t,memoBox:r,$DOM:o,nextTick:s}=e;return{setIsShowComponent:function(){n("isShowComponent").val(!n("isShowComponent").now())}}},data:{isShowComponent:!1}});return(0,s.jsx)(s.Fragment,{children:e})};const i=function(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom",children:[(0,s.jsx)("h1",{children:"Lifecycle / nextTick \u5143\u4ef6\u7684\u751f\u547d\u9031\u671f"}),(0,s.jsx)("div",{className:"btn-toolbar mb-2 mb-md-0",children:(0,s.jsxs)("div",{className:"me-2",children:[(0,s.jsx)("a",{href:"https://github.com/cid-chen/react-mvvm-component",target:"_blank",className:"btn btn-sm btn-outline-secondary",children:"View on GitHub"}),"\xa0",(0,s.jsx)("a",{href:"https://ko-fi.com/O4O21IE7IA",target:"_blank",children:(0,s.jsx)("img",{height:"34",style:{border:"0px",height:"34px"},src:"https://storage.ko-fi.com/cdn/kofi6.png?v=6",border:"0",alt:"Buy Me a Coffee at ko-fi.com"})})]})})]}),(0,s.jsx)("br",{}),(0,s.jsx)("h5",{children:"\u300c\u5143\u4ef6\u751f\u547d\u9031\u671f\u4e8b\u4ef6 - \u63d0\u5347\u53ef\u63a7\u5ea6\u3002\u300d"}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("h2",{className:"h2",children:"all lifecycle"}),(0,s.jsx)("div",{className:"card",children:(0,s.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,s.jsx)("li",{className:"list-group-item",children:(0,s.jsx)(c,{})}),(0,s.jsx)("li",{className:"list-group-item",children:"\u5143\u4ef6\u7684\u5404\u751f\u547d\u9031\u671f\u76e3\u807d\u8207\u89f8\u767c\u6642\u6a5f"}),(0,s.jsx)("li",{className:"list-group-item",children:(0,s.jsx)("div",{children:(0,s.jsxs)("pre",{children:[(0,s.jsx)("div",{className:"hljs-label",children:"js"}),(0,s.jsx)("code",{className:"language-javascript",dangerouslySetInnerHTML:{__html:(e="import React, { useState } from 'react';\nimport { useRespectVue } from '@gratefuljs/react-mvvm-component';\n\nconst ComponentA = ()=>{\n  \n  const [MVVMComponent, VMmethodsAPI] = useRespectVue(React, {\n    view : ({$VM, methods, refDOM}) => (\n      <div style={{border: 'solid 1px black', width: '100%', height: '100px'}}>\n        { $VM('showText') }\n\n        <button type=\"button\" onClick={methods.updateSomething}>\n          update ComponentA\n        </button>\n      </div>),\n    methods : ({$VM, getMethods, memoBox, $DOM, nextTick}) => ({\n      stepMsg : (msg) => {\n\n        alert('Lifecycle Demo: '+ msg);\n      },\n      updateSomething : () => {\n\n        const st = $VM('showText');\n \n        st.val(st.now()+'55', ()=>{\n \n          st.val(st.now()+'66', ()=>{\n \n            // \u5728\u591a\u6b21\u66f4\u65b0\u4e2d\u4f7f\u7528nextTick\uff0c\u8acb\u78ba\u4fdd nextTick \u653e\u5728\u6700\u5f8c\u4e00\u6b21\u66f4\u65b0\u7684callback\n \n            nextTick(()=>{ // \u65bc\u6700\u5f8c\u4e00\u6b21onViewUpdated\u89f8\u767c\u5f8c\uff0c\u9019\u624d\u6703\u89f8\u767c\n\n              getMethods().stepMsg('nextTick trigger!'); // call self methods\n            });\n          });\n        });\n      },\n    }),\n    data : {\n      showText : 'ComponentA here!'\n    },\n    // all lifecycle\n    onDataChange : (watchVM, methods)=>{\n\n      methods.stepMsg('some Data Changed!'); // \u89f8\u767c\u65bc\u4efb\u4f55key\u7684\u6578\u64da\u8b8a\u52d5\n\n      watchVM('showText', (newData, oldData)=>{\n        \n        methods.stepMsg(oldData+' => '+newData);\n      });\n    },\n    onViewWillMount(methods) {\n\n      methods.stepMsg('Component will mount!');\n    },\n    onViewMounted(methods) {\n\n      methods.stepMsg('Component mounted!');\n    },\n    onViewWillUpdate(methods) {\n\n      methods.stepMsg('Component will update!');\n    },\n    onViewUpdated(methods) {\n      \n      methods.stepMsg('Component updated!');\n    },\n    onViewWillUnmount(methods) {\n      \n      methods.stepMsg('Component will unmount!');\n    },\n    onViewUnmounted(methods) {\n      \n      methods.stepMsg('Component unmounted!');\n    },\n  });\n\n  return (<>{MVVMComponent}</>);\n};\n\nconst Example8_1 = ()=>{\n  \n  /* \u539f\u751f\u7684\u5beb\u6cd5\n  const [ isShowComponent, setIsShowComponent ] = useState(false);\n\n  return (<>\n    { isShowComponent && <ComponentA /> }\n\n    <button type=\"button\" onClick={()=>{\n\n      setIsShowComponent((prevState)=>{\n        return !prevState;\n      });\n\n    }}>generate / destroy ComponentA</button>\n  </>);\n  */\n  \n  /* \u65b0\u5beb\u6cd5 */\n  const [MVVMComponent, VMmethodsAPI] = useRespectVue(React, {\n    view : ({$VM, methods, refDOM}) => (\n      <>\n        { $VM('isShowComponent') && <ComponentA /> }\n\n        <button type=\"button\" onClick={methods.setIsShowComponent}>\n          generate / destroy ComponentA\n        </button>\n      </>),\n    methods : ({$VM, getMethods, memoBox, $DOM, nextTick}) => ({\n      setIsShowComponent : function(){\n\n        $VM('isShowComponent').val( !$VM('isShowComponent').now() );\n      },\n    }),\n    data : {\n      isShowComponent : false\n    },\n  });\n\n  return (<>{MVVMComponent}</>);\n};\n            ",document.createElement("div").appendChild(document.createTextNode(e)).parentNode.innerHTML)}})]})})})]})}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{})]});var e}},927:(e,n,t)=>{t.d(n,{i:()=>j});const r={},o={},s="onViewWillMount",u="onViewMounted",c="onViewWillUpdate",i="onViewUpdated",l="onViewWillUnmount",a="onViewUnmounted",m="onDataChange",d="methods",p="view",h="mixins",w="computed",f="$VM",g="function",x="object",M="nextTick",y="watch",C="init",b="paramErr1",v="memoBox",V="undefined",j=(e,n)=>{if(typeof e.version===V||e.version.split(".")[0]<17)return void console.error("params1 must be React and version >= 17 !");const{useState:t,useEffect:j,useRef:k,createRef:O,isValidElement:S}=e,T=k(0),$=k(!1);let P=Y(n.data);const[A,D]=t([null,P]),N=k(P),U=k(P);P=null;const[I,_]=t(null),R=k(!1),W=k(!1),B=k(!1),F=k(!1),E=k(null),L=k(null),q=(k({}),k("")),H=k(!1),J=(k(""),k({}),k({})),G=k(!1),X=k(null),z=(k({}),k({})),K=(k(),k(0));function Q(e,n){const t=Object.keys,r=typeof e;return e&&n&&r===x&&r===typeof n?t(e).length===t(n).length&&t(e).every((t=>Q(e[t],n[t]))):e===n}function Y(e){let n=Array.isArray(e)?[]:{};for(let t in e){let r=e[t];n[t]=typeof r===x&&null!==e?Y(r):r}return n}function Z(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=e=>{throw t+e};if(-1===n.indexOf("."))return e.hasOwnProperty(n)?e[n]:void r(n);const o=n.split("."),s=o.shift();if(e.hasOwnProperty(s))return t+=s+".",Z(e[s],o.join("."),t);r(s)}G.current={set:function(e,n){return J.current[e]=n,typeof J.current[e]!==V},get:function(e){return J.current[e]||!1},del:function(e){return delete J.current[e],typeof J.current[e]===V}};const ee=()=>{if(!1!==H.current){const e=H.current[q.current];let n;for(let t=0,r=e.length;t<r;t++){if(n=e.shift(),!0===F.current)return;typeof n===g&&n()}delete H.current[q.current],H.current=!1,q.current=""}},ne=(e,n)=>{const t=n,r=e[0];typeof r===g&&r(),t()},te=e=>{setTimeout((()=>{window.requestAnimationFrame((function(){setTimeout((()=>{e()}),0)}))}),0)},re=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e){case C:(()=>{const[e,t]=n;console.error(`${e} error: "${t}" is not init in the data object !`)})();break;case"dom":(()=>{const e=n;console.error(`$DOM error: use DOM key "${e}" is not exist !`)})();break;case b:(()=>{const[e,t]=n;console.error(`${e} error: param ${t} must be function !`)})();break;case"jsx":(()=>{const e=n;console.error(`${e}: must be a valid react component(JSX) !`)})()}},oe=function(e){return e(((t={})[f]=e=>{return(t={}).key=e,t.val=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(B.current)return;let o=()=>{};const s=this.key;typeof t===g?(o=()=>(t(),!0),typeof n[m]===g&&n[m](((n,t)=>{if(typeof t===g){if("*"!==n)try{let r,o,u=!0;if(r=e,o=U.current[s],!U.current.hasOwnProperty(s))throw n;n==s&&!0===u&&!1===Q(r,o)&&t(r,o)}catch(e){re(C,[y,n]),isToCompare=!1}}else re(b,[y,"2"])}),E.current),!0===R.current&&n.hasOwnProperty(c)&&n[c](E.current,r),D((n=>{const[t,r]=n,u={ref:null};new Promise((e=>{e(Promise.resolve((()=>new Promise((e=>{window.requestAnimationFrame((function(){e()}))})))))})).then((e=>new Promise((n=>{setTimeout((()=>{n(e)}),0)})).then((e=>(Promise.resolve((e=>e)).then((e=>Promise.resolve(e()))),()=>{U.current=u.ref}))))).then((e=>{e()}));let c=(e=>{let n=e;return Array.isArray(e)?n=[...e]:typeof e===x&&(n={...e}),n})(r),i=s;return u.ref=c,u.ref[i]=e,[o,{...c}]}))):re(b,[`${f}.val`,"2"])},t.update=function(e){let n;return e&&(n=e()),this},t.now=function(){const e=this.key;let n={...N.current};try{let t=n[e];return n=Array.isArray(t)||typeof t===x?Y(t):JSON.parse(JSON.stringify(t)),n}catch(n){return re(C,[f,e]),null}},t.then=function(e){e&&e()},t;var t},t[v]=G.current,t.getMethods=()=>E.current,t.$DOM=e=>!0!==z.current.hasOwnProperty(e)?(re("dom",e),null):z.current[e].current,t[M]=e=>{typeof e===g?(""===q.current&&(q.current=(.001*window.crypto.getRandomValues(new Uint8Array(1))).toString(36).slice(2,7)),!1===H.current&&(H.current=[],H.current[q.current]=[]),H.current[q.current].push(e)):re(b,[M,"1"])},t.eventBus=r,t.batchUpdate=function(){},t.globalBox=o,t));var t};if(null===E.current){if(E.current={},n.hasOwnProperty(d)){if(typeof n[d]!==g)return void re(b,[d,"1"]);let e=n[d];E.current=oe(e),e=null}n.hasOwnProperty(h),E.current.unmountView=()=>{!1===F.current&&(F.current=!0,B.current=!0,n.hasOwnProperty(l)&&n[l](E.current,r),D(!1),_(null))}}return null===X.current&&(X.current={},n.hasOwnProperty(w)),null===L.current&&(L.current={},n.hasOwnProperty(h)),j((()=>{!1!==A?(N.current=Y(A[1]),((e,t,r,o)=>{const s=n=>{if("*"===n)return e;try{return Z(e,n)}catch(e){return re(C,[f,e]),null}},u=e=>(!0===z.current.hasOwnProperty(e)||(z.current[e]=O()),z.current[e]),c=n[p]((e=>(e[f]=s,e[d]=t,e.refDOM=u,e[w]=r,e[v]=G.current,e.components=o,e))({}));!0===S(c)?_(c):re("jsx",p)})(A[1],E.current,X.current,L.current)):_(null)}),[A]),j((()=>{!0===W.current&&!0!==F.current&&te((()=>{((e,t,o)=>{const s=e;!0!==F.current&&(n.hasOwnProperty(i)&&n[i](E.current,r),s(t,o))})(ne,A,ee)}))}),[A]),j((()=>{if(!0!==F.current){if(!0===R.current&&!1===W.current)te((()=>{setTimeout((()=>{n.hasOwnProperty(u)&&n[u](E.current,r)}),0)})),W.current=!0;else if(!0===W.current&&$.current&&2==T.current)return void(T.current=3);!1===R.current&&null===I&&(n.hasOwnProperty(s)&&n[s](E.current,r),R.current=!0)}else te((()=>{n.hasOwnProperty(a)&&n[a](E.current,r),N.current=null,E.current=null}))}),[I]),j((()=>{T.current++,T.current>1&&($.current=!0)}),[]),j((()=>()=>{setTimeout((()=>{window.requestAnimationFrame((function(){setTimeout((()=>{$.current&&K.current++,1!=K.current&&(B.current=!0,n.hasOwnProperty(l)&&n[l](E.current,r),F.current=!0,setTimeout((()=>{n.hasOwnProperty(a)&&n[a](E.current,r)}),0))}),0)}))}),0)}),[]),[I,E.current,r]}}}]);